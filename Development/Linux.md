![[Pasted image 20231219034033.png]]
>[!info] Чтобы перейти в текстовый режим CTRL-ALT-F1, а вернуться в графический сеанс на терминал, в которым вы вошли CTRL-ALT-F7

>[!info] При загрузке можно удерживать Shift, чтобы открыть меню Grub

#### Каталоги Linux
>[!info] В Linux всё есть файл.

|Путь|Описание|
|----|--------|
|`/`|Корневой|
|`/bin`|Основные утилиты(cat, ls, cp)
|`/boot`|Загрузочные файлы(файлы загрузчика, ядро, initrd)
|`/dev`|Основные файлы устройств
|`/etc`|Общесистемные конфиги
|`/home`|Домашние каталоги пользователя
|`/lib`|Основные библиотеки для работы программ из /bin и /sbin
|`/media`|Точки монтирования для сменных носителей
|`/mnt`|Временно монтируемые файловые системы
|`/opt`|Дополнительное ПО
|`/proc`|Виртуальная файловая система, представляющая состояние ядра ОС и запущенных процессов в виде файлов
|`/root`|Домашний каталог пользователя root
|`/run`|Информация о системе с момента загрузки, в т.ч. данные, необходимые для работы демонов(pid-файлы, UNIX-сокеты)
|`/sbin`|Основные системные программы для администрирования и настройки
|`/srv`|Данные для сервисов(например www или ftp)
|`/sys`|Данные об устройствах и драйверах, а также некоторых св-вах ядра
|`/tmp`|Временные файлы
|`/usr`| Вторичная иерархия для данных пользователя. Содержит большинство пользовательского ПО, используемого в многопользоват. режиме. Все установленные пакеты программ, документация, исходный код ядра.
|`/var`|Изменяемые файлы(реги, временная почта, файлы спулеров)

#### СЛУЖБЫ
|Команда|Описание|
|-------|--------|
|`sudo service ssh status`|состояние службы
|`sudo service ssh start `|запуск службы
|`sudo service apache2 stop`|остановить службу
|`sudo service apache2 reload`|перезапустить службу
|`sudo systemctl is-enabled ssh`|проверить включена ли служба
|`sudo systemctl enable ssh.socket`|добавление службы в автозагрузку
|`sudo systemctl disable ssh.socket`|удаление из автозагрузки
|`sudo systemctl status ssh.socket`|состояние службы
|`sudo systemctl start ssh.socket`|запуск службы
|`sudo systemctl stop ssh.socket `|остановка службы
|`sudo systemctl restart ssh.socket`|перезапуск службы
|`sudo systemctl reload ssh.socket`|перезапуск службы

#### ОСНОВЫ
- автодополнение `TAB`
- история комманд - стрелки вверх/вниз
- `CTRL-A` в начало строки
- `CTRL-E` в конец строки
- абсолютный путь начинается со `/`
- `.` текущая директория
- `..` директория выше
- `--help`  ключ справки

###### grep
```
$ grep [options] pattern [files]
```
Поиск среди нескольких файлов:
```
$ sudo grep -i err /var/log/messages
```
Регистронезависимый поиск:
```
$ grep -i [pattern] [file]
```
Поиск слова:
```
$ grep -w [pattern] [file]
```
Вывод количества совпадений:
```
$ grep -c [pattern] [file]
```
Рекурсивный поиск:
```
$ grep -r [pattern] *
```
Вывод нумерации строк:
```
$ grep -n [pattern] [file]
```
Вывод списка файлов:
```
$ grep -l [pattern] [file]
```

###### Основные команды
>[!info] <команда> <ключи> <аргументы>

|Команда|Описание|
|-------|--------|
|`nano`|текстовый редактор
|`open test.txt`|открывает файл, директорию и тд
|`locate 123.txt`|быстрый поиск файла
|`file 123.txt`|определить тип файла 123.txt
|`find . -name "Ft*"`|найти в текущем каталоге по имени, всё что начинается с "Ft.."
|`find . -size +5M`|найти в текущем каталоге по размеру, всё что больше 5 Мбайт
|`find . -size -5M`|найти в текущем каталоге по размеру, всё что меньше 5 Мбайт
|`find . -type d `|найти в текущем каталоге по типу, директории
|`echo 123`|выводит текст 123
|`echo $((2**3))`|формат для арифметических выражений(2 в степени 3)
|`echo Число_{1..5} `|выведет: Число_1 Число_2 Число_3 Число_4 Число_5
|`pwd`|показывает адрес текущего каталога
|`man rm`|руководство к комманде rm(обычно более подробный чем --help)
|`ls -h`|содержимое текущей директории(-h человекопонятный)
|`ls -la Documents/`|содержимое папки Documents(-l доп инфрпмация -а скрытые)
|`ls -t`|содержимое текущей директории(-t по последнему изменению)
|`ls -r`|содержимое текущей директории(-r по дате создания)
|`stat file2`|подробная информация о file2
|`touch file `|создать файл с именем file
|`touch dir/file2`|создать файл с именем file
|`mkdir dir `|создать директорию с именем dir
|`mkdir dir/dir2 `|создать директорию с именем dir2
|`mkdir -p dir/dir2/dir3/dir4`|создать директорию dir4 и дополнительно несуществ. ещё директории выше
|`mkdir {2007..2009}-{01..12}`|создаёт папки 2007-01, 2007-02, 2007-03 и так до 2009-12
|`cd`|в директорию пользователя(/home/ufodriver/)
|`cd /home/`|в директорию home
|`rm file1 `|удалить файл с именем file1
|`rm file*`|удалить все файлы по маске(начинающиеся с file...)
|`rmdir`|удалить пустую директорию
|`rm -r dir3  `|удалить рекурсивно директорию и всё в ней
|`rm -rf dir3 `|удалить рекурсивно директорию и всё в ней принудительно, без ошибок
|`cp file2 dir3/`|скопировать file2 в dir3
|`cp -r dir2 dir3/ `|скопировать рекурсивно(директорию и всё в ней) dir2 в dir3
|`mv file2 dir3/`|переместить file2 в dir3
|`mv dir2 dir3/`|переместить dir2 в dir3
|`mv file2 file_new`|переименовать file2 в file_new
|`type rm `|показать тип(бинарный файл, алиас, встроенная комманда)
|`echo $PATH`|показать сообщение или содержание переменной
|`who`|кто работает на сервере
|`whatis ls`|однострочное описание комманды ls
|`whereis bash`|утилита, позоляющая найти расположение  бинарных, исходных и справочных файлов для данной команды.
|`which ls`|определение местоположения выполняемого файла
|`cat file2 `|позволяет создавать, объединять, а также выводить содержимое файлов в командной строке или в другом файле
|`cat > file2 `|можно быстро записать что-то в файл file2
|`grep "failed" ./log`|Напечатать вывод по регулярному выражению из файла log(-i игнор регистра)
|`head ./log `|Выводит первые 10 строк файла
|`head -n 3 ./log`|Выводит первые 3 строки файла
|`tail ./log`|Выводит последние 10 строк файла
|`tail -f .log`|Выводит последние 10 строк файла и продолжить смотреть в файл
|`id ufodriver`|показывает uid, gid, группы
|`clear`|очистить окно
|`exit`|выход
|`shutdown now`|выключить сейчас
|`poweroff`|выключить сейчас
|`reboot now `|перезагрузить сейчас
|`sudo su`|root режим
|`sudo !!`|выполнить через sudo последнюю комманду
|`chmod u-w file2`|смена прав для file2(юзеру - отмена записи)
|`chmod o+w file `|смена прав для file2(остальным - возможность записи)
|`chmod u+rwx,g-x+rw,o-rwx file2`|смена прав для file2(юзеру - возможность rwx, группе - отменяем исполнение, добавляем rw, остальным - отменяем rwx)
|`chmod -R a+rwx dir/`|права для всех(-a) максимальные(+rwx) рекурсивно(-R), те для всего содержимого
|`chmod 777 file2 `|максимальные права для всех на file2
|`chown ufodriver: ~ufodriver/file.txt`|сменить владельца файла на ufodriver и его группу(:)
|`chattr +s file1 `|позволяет сделать удаление файла безопастным. Всё место забив. нулями при удалении
|`ln -s file file_sl `|сделать софт-линк(ярлык, опирается на имя) файла file с именем file_sl
|`ln file file_hl`|сделать хард-линк(ярлык, опирается на inode) файла file с именем file_hl
|`more log`|просмотрщик файла(q для выхода, enter и пробел листать)
|`less log`|просмотрщик файла(q для выхода, enter, пробел и стрелки - листать, / для поиска вперёд, ? для поиска назад)
|`systemd-analyze`|время загрузки системы
|`uptime`|время бесперебойной работы
|`date`|дата
|`cal`|календарь(sudo apt install ncal)
|`du -ch /home/ufodriver`|показать объём директории(-с итоговое, -h человекопонятное)
|`df -h`|использование дискового пространства(-h человекопонятные ед.измерения)
|`free`|использование RAM(свободно и занято)
|`alias foo='cd /usr; ls; cd -'`|создание алиаса(псевдонима) foo(свободно ли имя можно проверить с помощью type)
|`unalias foo`|удалить алиас
|`wc names.txt`|word counter(без аргументов возвращает числа строк, слов, байт;-l только строки)
|<code>history \| less</code> |посмотреть историю команд
|`passwd ufodriver`|смена пароля для ufodriver
|`sudo ufw enable`|включить простой брандмауэр
|`sudo ufw reload `|перезагрузить службу брандмауэра
|`sudo ufw status verbose`|проверить состояние и полные сведения о брандмауэре ufw
|`sudo fdisk -l`|показывает разделы, в т.ч. и логические
|`sleep 1000 `|задержка в 1000 мс
|`xxd file.txt`|hex-редактор
|`telnet google.com 80`|telnet
|`date 041217002007.00`|установить системную дату (МесяцДеньЧасМинутыГод.Секунды)
|<code>ls -alct /\|tail -1\|awk '{print $6, $7, $8}'</code>| дата установки системы

#### АВТОЗАГРУЗКА
###### Автозагрузка в системе инициализации(systemd)
1. Создадим файл по адресу `/lib/systemd/system/`, и назовем его `hello.service`
2. Заполняем свежесозданный файл:
```
[Unit]
Description=Hello script
After=multi-user.target

[Service]
Type=idle
ExecStart=/home/sysadmin/hello.sh

[Install]
WantedBy=multi-user.target
```
>[!info] В первой строчке секции Unit можно написать краткое описание исполняемого файла, вторая отвечает за возможность запуска данного скрипта в многопользовательском режиме. В секции Service, Type отвечает за однократный запуск (при значении idle), а ExecStart - это путь к исполняемому файлу.

3. Даем права на чтение всем пользователям:
```
sudo chmod 644 /lib/systemd/system/hello.service
```
4. Обновляем список доступных сервисов systemd:
```
sudo systemctl daemon-reload
```
5. Включаем автозагрузку сервиса hello:
```
sudo systemctl enable hello.service
```

###### Автозагрузка при входе пользователя в систему
- Общие для всех пользователей файлы находятся в директории `/etc/`
- Для каждого пользователя так же существуют отдельные экземпляры данных файлов, которые находятся в корне их домашних директорий- например, у пользователя sysadmin, они будут находится по пути `/home/sysadmin`.

|Файл|Описание|
|-----|---------|
|`.bash_profile`|данный файл используется для загрузки файлов `.profile` и `.bashrc`
|`.bashrc`|содержимое данного файла загружается при входе в режим терминала
|`.profile`|содержимое данного файла загружается при загрузке графической оболочки

>[!example] Например в файл `/home/ufodriver/.profile` добавить строчку `exec /usr/bin/firefox &` (выполнить скрипт firefox в фоновом режиме)


#### ПЕРЕМЕННЫЕ СРЕДЫ
|Команда|Описание|
|-----|---------|
|`env`|вывод переменных среды
|`export ABC=123`|задание переменной(переменная окружения будет установлена для текущего сеанса оболочки)
|`unset ABC`|отключение переменной
|<code>printenv \| less</code>|список переменных окружения с их значениями
|`printenv USER`|вывести знвчение переменной user
|<code>set \| less</code>|выводит переменные обоих типов — командной оболочки и окружения, а также все объявленные функции командной оболочки
|`echo $HOME`|вывести переменную `HOME`
|`alias`|список псевдонимов

Экранирование:
- `"" `определяют как один аргумент, подавляют спецсимволы, кроме  <code>$ \ `</code>
- `''` подавляют все подстановки

#### ПРАВА ДОСТУПА НА ФАЙЛЫ
>[!info] Пользователь определяется не по имени(это просто псевдоним), а по UID
>`root` имеет UID 0
>`/etc/passwd ` файл со списком пользователей
>`/etc/group`   файл с группами пользователей
>`/etc/shadow`  файл с хэшем паролей

`sudo usermod -aG mail ufodriver`      добавить пользователя ufodriver в группу mail(-a добавить -G в группу)
`sudo usermod -aG docker ufodriver` добавить пользователя ufodriver в группу docker

###### Права доступа
|Обозначение| Описание|Значение|
|:-----------:|------------|------------:|
|**r**|readable |4|
|**w**|writeable|2|
|**x**|executable |1|

Пример:
```
drwx------         dir
-rw-r--r--         file
lrwx------         link
brwx------         блочное усторйство 
crwx------         символьное устройство
```
- Первый символ - тип файла(`d` директория, - файл)
- Первая тройка(`rwx`) права пользователя (`u`)
- Вторая тройка(`rwx`) права группы (`g`)
- Третья тройка(`rwx`) права для остальных(не явл. владельцем и членом группы) (`o`)
>[!info] Права `x` на директорию означ., что можно зайти в неё. А права `r`, что можно отобразить содержимое.

|Команда|Описание|
|------------|------------------|
|`chmod u-w file2`|смена прав для file2(юзеру - отмена записи)
|`chmod o+w file`|смена прав для file2(остальным - возможность записи)
|`chmod -R a+rwx dir/`|права для всех(-a) максимальные(+rwx) рекурсивно(-R), те для всего содержимого
|`chmod 777 file2`|максимальные права для всех на file2
|`chown ufodriver`| сменить принадлежность файла, назначив владельцем ufodriver
|`chown ufodriver:users` |сменить принадлежность файла, назначив владельцем ufodriver и группу users
|`chown :admins`  |сменить принадлежность файла, назначив владельцем группу admins
|`chown ufodriver:`| сменить принадлежность файла, назначив владельцем  ufodriver и его группу

#### ПОТОКИ И КОНВЕЙЕРЫ
|Команда|Описание|
|------------|------------------|
|`>`|перезаписывает/создаёт файл перенаправляя поток вывода(1)
|`>>`|добавляет в файл перенаправляя поток вывода(1)
|`2>`|перезаписывает/создаёт файл перенаправляя поток ошибок(2)(явное указание файлового дескриптора)
|`2>>`|добавляет в файл перенаправляя поток ошибок(2)
|`&>`|перезаписывает/создаёт файл перенаправляя поток вывода(1) и поток ошибок(2)
|`&>>`|добавляет в файл перенаправляя поток вывода(1) и ошибок(2)
|`<`|взять из
|`ls -l asdf 1> file 2>&1`|поток вывода ls перенаправляет в file, и поток ошибок в то же место
|`ls -l asdf &>> file`|поток вывода ls перенаправляет в file, и поток ошибок в то же место
|<code>cat stdout \| grep ^-</code>|pipe. перенаправление потока вывода одной программы в поток ввода другой. ^ начало строки. Pipe интерпретируется всегда ПЕРВЫМ
|<code>ls -l \| tee file2</code>|перенаправляет поток вывода ls в поток ввода tee, которая выводит и в файл, и на экран(перезаписывает, для добавления tee -a file2)
|`ls -l > /dev/null`|перенаправить в никуда(битоприёмник bit bucket)
|`xargs`|передаёт построчно
|<code>find . -name "*.txt" \| xargs rm -f</code>|Найти в текущем каталоге все файлы txt и построчно(по одному) передать программе удаления(-f принудительно, не печатая ошибок)

>[!info] В bash'е код возврата 0 это успех, не ноль - это False

|Команда|Описание|
|------------|------------------|
|`&&`|логическое И
|`ls -l && echo OK`|в случае успеха первой комманды - выполняется вторая
|<code>\|\|</code>|логическое ИЛИ
|<code>ls -l \|\| echo ERR</code>|Первая успешная комманда исполняется
|`;`|логическое НЕ ИМЕЕТ ЗНАЧЕНИЕ
|`ls -l ; echo test`|выполняется одна комманда, затем следующая. Результат не имеет значения для продолжения

#### ДИСКИ
>[!info] Диски в каталоге `/dev/` .Если в конце названия цифра - это логический диск(напр. sda1)

>[!info] Точки монтирования при старте описаны в файле `/etc/fstab` (Сюда нужно добавлять винты для автоматич. монтирования). Файл с инфо о точках монтирования `/proc/self/mounts`

|Команда|Описание|
|------------|------------------|
|`sudo fdisk -l`|показывает разделы, в т.ч. и логические
|`lsblk`|инфо о блочных устройствах
|`blkid`|id блочных устройств
|`df -h`|информация о смонтированных устройствах
|`du -h`|использованное пространство
|`du -hc /home/ufodriver/*`|сколько пространства занимает `/home/ufodriver`(c - итоговый объём)
|`mount`|подробная информация о смонтированных устройствах
|`sudo mount /dev/sda /mnt/`|cмонтировать(что куда)
|`umount /mnt/`|размонтировать(где)
|`umount /dev/sda `|размонтировать(что)
|`tail -f /var/log/messages`|приём для наблюдения за сисемой в реальном времени(например при подключении устройства)
|`fsck /dev/sdb1 `|проверка файловой системы `sdb1`
|`debugfs -w /dev/sdb1`|дебаг файловой системы(далее можно воспользоваться коммандой `help`, выйти - `q`)
|`dumpe2fs /dev/sdb1 `|дамп диска

###### Тест скорости чтения/записи
```
lsblk                                  # список устройств
sudo hdparm -t --direct /dev/sdd       # тест устройства
```

#### УСТАНОВКА ПО
|Команда|Описание|
|------------|------------------|
|`dpkg`|низкоуровневый инструмент для Debian(установка/удаление)
|`apt`|пакетный менеджер семейства Debian. Высокоуровневый инструмент(поиск метаданных и разрешение зависимостей)
|`sudo apt install telegram-desktop`|установить `telegram-desktop`
|`sudo apt remove telegram-desktop`|удалить пакет
|`sudo apt search apache `|поиск пакетов с именем apache
|`sudo apt-get purge PackageName`|удаление пакета и файлов конфигурации
|`sudo apt-get autoremove`|очистить все неиспользуемые пакеты и зависимости
|`sudo apt list --installed`|список установленных пакетов
|`sudo apt install -f`|починить зависимости
|`sudo apt install -y`|установка без запроса подтверждения
|`sudo apt-get update `|обновляет индекс пакетов в системе Linux или списки пакетов
|`sudo apt-get upgrade`|обновляет все устаревшие пакеты, находящиеся в вашей системе, до последних версий
|`sudo apt dist-upgrade`|обновление системы(обновление пакетов)
|`dpkg --get-selections`|список установленных пакетов
|`dpkg -l`|список установленных пакетов
|`dpkg -i st.deb`|если пакет загружен не из репозитория, устанвливает без разрешения зависимостей
|`dpkg -s nginx`|проверить статус пакета, установлен ли он
|`dpkg -L apache2 `|список файлов пакета
|`dpkg -S /usr/bin/cloud`|информация о пакете по файлу

###### Репозитории
```
sudo add-apt-repository ppa:danielrichter2007/grub-customizer               добавить репозиторий
sudo add-apt-repository --remove ppa:danielrichter2007/grub-customizer      удалить репозиторий
```
>[!info] PPA-репозитории можно найти в директории `/etc/apt/sources.list.d `. Можно просто удалить файл.

#### АРХИВИРОВАНИЕ
###### TAR
|Команда|Описание|
|------------|------------------|
|`tar -czvf archive.tar.gz folder`|Создать архив(`-с` create archive;`-z` gzip;`-v` подробно; `-f` файл для записи архива) из папки `folder`
|`tar -xvf archive.tar.gz`|Разархивировать архив(`-x` eXtract извлечь;`-v` подробно)
|`tar -xvf archive.tar.gz -C folder`|Разархивировать архив(`-x` eXtract извлечь;`-v` подробно) в папку `folder`

###### ZIP
|Команда|Описание|
|------------|------------------|
|`zip -re archive.zip folder`|Создать zip архив из папки folder(`-r` рекурсивно обходить каталоги;`-e` encrypted с паролем)
|`zip archive.zip 1.txt 2.txt 3.txt`|Создать zip архив из трёх файлов
|`unzip archive.zip`|Распаковать zip архив
|`unzip archive.zip -d folder`|Распаковать zip архив в папку folder

###### CPIO
|Команда|Описание|
|------------|------------------|
|`cpio -id < archive.cpio `|Извлечение из архива в текущую директорию(`-i` извлечение, `-d` для воссоздания дерева директорий при необходимости)
|<code>ls \| cpio -o > archive.cpio </code>|Создание архива с перенаправлением стандартного потока вывода
|<code>find . -name ".txt" \| cpio -o > archive.cpio</code>|Найти в текущ. директории все файлы `txt` и создать из них архив

###### DD
>[!info] Для определения устройств `lsblk`

|Команда|Описание|
|------------|------------------|
|`dd if=/dev/sdb of=drive.img `|Скопировать поблочно весь раздел `sdb` в файл `drive.img`
|`dd if=~/linux.iso of=/dev/sdc bs=5M`|Записать образ на флешку(sdc), блоками по 5 МБ
|`dd if=/dev/zero of=/dev/sdb`|Забить нулями устройство `sdb`(чтобы не воостановили данные)
|`dd if=/dev/sda of=mbr.img bs=512 count=1`|Скопировать одним куском первые 512 байт(MBR)
|`dd if=mbr.img of=/dev/sda `|Восстановить MBR из образа
|`dd if=/dev/zero of=image bs=1M count=1000`|Генерирует файл из нулей размером 1 ГБ

#### ПРОЦЕССЫ
>[!info] Управлять процессом может только владелец или root

- Приоритеты от -20(самый большой) до +19(самый маленький).
- NICE 0 приоритет по умолчанию.

|Команда|Описание|
|------------|------------------|
|`PID`|Process ID
|`PPID`|Parent Process ID
|`nice -n 19 audacious `|Запустить и установить приоритет 19(самый маленький)
|`renice 5 -p 2572`|Установить новый приоритет процессу 2572 на +5(т.е. больше на 5)
|`renice 15 -u ufodriver`|Установить новый приоритет пользователю ufodriver на +15
|`/proc/<pid> `|место хранения процесса в файловой системе
|`kill 7547 `|Запрос на закрытие процесса 7547(по умолчанию посылает сигнал -15)
|`kill -15 7547`|Запрос на закрытие процесса 7547
|`kill -9 7547`|Уничтожение процесса 7547
|`xkill`|Можно указать мышкой зависшее окно
|`killall firefox`|Убить все экземпляры процесса
|`pkill audacious`|Убить процесс с именем audacious
|`ps x`|просмотр всех процессов
|`ps aux`|детальное описание процессов с % использования CPU(`a` все процессы, `x` вообще все, `u` фильтрация по пользователю)
|<code>ps aux \| grep [имя программы]</code>|Найти описание процесса с PID
|`pgrep firefox`|Найти PID процесса(ов) firefox
|`pstree`|визуализация древа процессов
|`xlogo &`|`&` для запуска процесса сразу в фоновом режиме
|`jobs`|список заданий запущенных в терминале
|`fg %1`|перевести задачу `1` в `jobs` на передний план в терминале
|`CTRL-Z`|для перевода задачи переднего плана терминала в состояние `suspended`
|`vmstat 3`|снимок с информацией об использовании системных ресурсов(обновление каждые 3 сек)
|`gnome-system-monitor`|показывает системный монитор

#### ПОЛЬЗОВАТЕЛИ
|Команда|Описание|
|------------|------------------|
|`useradd -m -s /bin/bash -G sudo mike`|Добавить пользователя `mike`(`-m` создает домашний каталог, `-s` устанавливает путь до оболочки, которая будет доступна по умолчанию, `-G` позволяет сообщить системе в каких группах будет состоять пользователь)
|`sudo useradd Sergey`|Добавить пользователя Seregey
|`adduser Sergey sudo`|Добавить пользователя в группу sudo, чтобы он мог временно повышать свои привилегии
|`sudo passwd Sergey `|Задать пароль для пользователя Seregey
|`sudo userdel Sergey`|Удалить пользователя Seregey
|`sudo usermod -L Sergey`|Заблокировать учётную запись пользователя Seregey

#### СЕТЬ
|Команда|Описание|
|------------|------------------|
|`sudo netstat -tulpen`|посмотреть открытые порты
|`sudo netstat -ntpl`|посмотреть порты которые слушаются
|`telnet python.org 80`|проверка, что по порту 80 можно действительно подключиться
|`ping -A ya.ru `|быстрый пинг ya.ru
|`host ya.ru`|где хостится ya.ru
|`nslookup python.org`|попросить DNS-сервер зарезолвить домен
|`ip a`|инфо об адресе
|`ip r`|шлюз(маршрут по умолчанию, место, куда идут пакеты не для нашей лок. сети)
|`/etc/resolv.conf`|файл с DNS адресом
|`/etc/hosts`|файл hosts
|`sudo ss -tnlp`|порты (`-t` tcp `-n` numeric `-l` listen `-p` program)
|`ip link show`|отобразить состояние всех интерфейсов
|`ifconfig`|список интерфейсов, подключенных к вашей системе и активированных в данный момент
|`ifup eth0`|активировать интерфейс eth0
|`ifdown eth0`|деактивировать интерфейс eth0
|`cat /proc/net/dev`|сетевые интерфейсы и статистика по ним
|`route`|таблица маршрутизации
|`ip route show match 0/0`|адрес шлюза
|`/etc/network/interfaces`|файл с интерфейсами

>[!info] Обычно два интерфеса `enp0s3` и `lo`, но он виртуальный и указывает на эту машину

###### Автоматическое получение IP
Добавляем в файл эти строчки:
```
auto enp0s3              (загружать интерфейс enp0s3 при загрузке)
iface enp0s3 inet dhcp   (интерфейс enp0s3 с типом dhcp)
```
И перезапускаем сетевой сервис:
```
sudo service networking restart
```

###### статический IP
Добавляем в файл эти строчки:
```
auto eth0
iface eth0 inet static
address 192.168.1.7
gateway 192.168.1.1
netmask 255.255.255.0
network 192.168.1.0
broadcast 192.168.1.255
```
И перезапускаем сетевой сервис:
```
sudo service networking restart
```
```
ifconfig eth0 192.168.1.1 netmask 255.255.255.0      выставить адрес и маску для интерфейса eth0
dhclient eth0                                        активировать в режиме dhcp
```

#### ИНФО О СИСТЕМЕ
|Команда|Описание|
|------------|------------------|
|`neofetch`|простая утилита для вывода информации о программном и аппаратном обеспечении вашей системы
|`uname -a`|подробный выывод об ОС
|`arch`|архитектура
|`cat /etc/*release`|версия дистрибутива
|`cat /etc/issue`|версия дистрибутива
|`lsb_release -a`|версия дистрибутива
|`hostnamectl`|подробная информации о системе
|`hostname`|имя компьютера
|`uname -n`|имя компьютера
|`hostnamectl set-hostname hostname`|изменить имя компьютера (возможно потребуется systemctl restart systemd-hostnamed)
|`lscpu`|информация о процессоре
|`free -h`|информация о памяти(оперативная и swap)
|`htop`|"диспетчер задач" Linux
|`gnome-system-monitor`|"диспетчер задач" Linux

#### Создание скриптов
###### bash
```
#!/bin/bash
echo "Hello world"
```

###### python
```
#!/usr/bin/env python3
print("Hello world")
```

#### Планировщик CRON
Добавление пользователя в группу crontab(чтобы cron отслеживал)
```
sudo usermod -a -G crontab ufodriver
```
Запускаем cron
```
sudo cron
```
Заходим в cron
```
crontab -e
```
Команда
```
*****путь_к_питону путь_к_скрипту
(минута)-(час)-(день месяца)-(месяц)-(день недели)
```

##### Примеры комманд
###### Минуты

`* * * * *` — каждую минуту.  
`0 * * * *` — каждый час в 0 минут.  
`15 * * * *` — каждый час в 15 минут (0:15, 1:15 и так далее).  
`*/15 * * * *` — каждые 15 минут.  
`0,15,25 * * * *` — три раза в час, в 0, 15 и 25 минут.  
`15-25 * * * *` — каждую минуту в каждом часу, начиная с 15-ой минуты и заканчивая 25-ой.

###### Часы

`* 4 * * *` — каждую минуту в 4-ом часу каждого дня.  
`* */4 * * *` — каждую минуту в каждом 4-ом по счёту часу, начиная с полуночи (4, 8, 12, 16, 20, 0).  
`0 */4 * * *` — каждые четыре часа в 0 минут.  
`0 4 * * *` — каждый день в 4:00.  
`0 4,17,23 * * *` — каждый день в 4:00, 17:00 и 23:00.  
`* 4-17 * * *` — каждую минуту в каждом часу, начиная с 4-ого часа и заканчивая 17-ым.  
`* 4-17/2 * * *` — каждую минуту каждый второй час в диапазоне между 4-ым и 17-ым часами (6, 8, 10, 12, 14, 16).

###### Дни месяца

`* * 6 * *` — каждую минуту в каждом часу 6-го числа каждого месяца.  
`15 4 6 * *` — 6-го числа каждого месяца в 4:15.  
`15 4 */6 * *` — в 4:15 в каждый 6-ой день месяца (6, 12, 18, 24, 30).  
`15 4 6-9 * *` — в 4:15 каждого дня каждого месяца, начиная с 6-ого числа и заканчивая 9-ым.  
`15 4 6,11,25 * *` — в 4:15 6-ого, 11-ого и 25-ого числа каждого месяца.

###### Месяцы

`* * * 8 *` — каждую минуту каждого часа каждого дня в августе (8-ой месяц года).  
`* * * */2 *` — каждую минуту каждого часа каждого дня в каждый второй месяц года (февраль, апрель, июнь, август, октябрь, декабрь).  
`* * * 2-8 *` — каждую минуту каждого часа каждого дня в каждый месяц, начиная с февраля и заканчивая августом.  
`* * * 2,8 *` — каждую минуту каждого часа каждого дня в феврале и в августе.  
`15 4 * 3 *` — каждый день в марте в 4:15.  
`15 4 6 3 *` — каждый год 6 марта в 4:15.

###### Дни недели

`* * * * 4` — каждую минуту каждого часа в каждый четверг каждого месяца.  
`11 11 * * 4` — каждый четверг в 11:11.  
`11 11 4 * 4` — каждое 4-ое число и каждый четверг в 11:11 (не означает, что 4-ое число обязательно должно выпадать на четверг).  
`11 11 4 4 4` — 4 апреля и каждый четверг в апреле в 11:11.  
`11 11 * * 0` или `11 11 * * 7` — каждое воскресенье в 11:11.  
`11 11 * * 1-5` — каждый будний день (с понедельника по пятницу) в 11:11.

Некоторые самые распространённые варианты периодичности можно задавать таким образом:

`@reboot` — одиночное выполнение команды при перезапуске сервера.  
`@yearly` или `@annually` — ежегодно.  
`@monthly` — ежемесячно.  
`@weekly` — каждую неделю.  
`@daily` или `@midnight` — ежедневно.  
`@hourly` — каждый час.

Помните, что каждый файл crontab должен заканчиваться пустой строкой, иначе последнее правило или сразу весь файл будут проигнорированы. Все задания текущего пользователя удаляются с помощью команды `crontab -r`. А с помощью `man crontab` вы сможете увидеть справку о cron.

#### RASPBERRY
Подключение по ssh:
```
ssh pi@[IP Address]
```
логин: `raspberry`
пароль:`pi`
интерфейс конфигуратора Raspberry: `sudo raspi-config`
температура процессора: `vcgencmd measure_temp`

###### Установка raspi-config в Ubuntu
```
wget https://archive.raspberrypi.org/debian/pool/main/r/raspi-config/raspi-config_20200601_all.deb -P /tmp
sudo apt-get install libnewt0.52 whiptail parted triggerhappy lua5.1 alsa-utils -y
# Auto install dependancies on eg. ubuntu server on RPI
sudo apt-get install -fy
sudo dpkg -i /tmp/raspi-config_20200601_all.deb
```

#### NGINX
|Команда|Описание|
|------------|------------------|
|`sudo apt-get install nginx`|установить nginx
|`sudo service nginx start`|запустить nginx
|`sudo service nginx stop`|остановить nginx
|`sudo ufw allow 'Nginx HTTP'`|разрешить с других устройств подключаться к серверу по порту 80
|`sudo ufw allow 'Nginx HTTPS'`|разрешить с других устройств подключаться к серверу по порту 443

>[!info] Место хранения сайта: `/var/www/html`

#### TOP(HTOP)
>[!info] top(или htop) утилита, показывающая процессы(Первые несколько, потребляющих больше всего процессорного времени.

- Листать стрелками(вверх, вниз, влево, вправо)
- Нажав S можно изменить задержку вывода.
- load average(в утилите top) очередь процессов на процессорное время. Нормальное значение <= кол-во ядер процессора.
    1ое значение - за 1 минуту
    2ое значение - за 5 минут
    3е значение - за 15 минут

|Команда|Описание|
|------------|------------------|
|`F5`|Все процессы в виде дерева
|`M`|Сортировка по потребляемой памяти
|`P`|Сортировка по потреблямому процессорному времени
|`/`|Поиск(Затем вводим имя)
|`\`|Фильтр(Затем вводим имя). Находим все процессы с этим названием. Сброс \ ESC
|`u`|`Выбрать пользователя, для просмотра его процессов`
|`k`|Послать сигнал(сигнал `15` для "мягкого" закрытия, `9` для уничтожения)
|`q`|Выход
|`пробел`|выделение процесса
|`Shift-U`|снять выделение

>[!tip] Посмотреть какой процесс занимает определённый порт: `ss -ltnup 'sport = :22'`

#### TMUX(Терминальный мультиплексор)
|Команда|Описание|
|------------|------------------|
|`sudo apt install tmux`|установить tmux
|`tmux new-session -s test`|Создать новую сессию с именем test
|`tmux attach -t test`|Присоедениться к сессии test
|`tmux ls`|Список сессий
|`tmux list-clients`|Список клиентов
|`tmux kill-session -t session1`|Убить сессию
|`tmux kill-server`|Убить все сессии
|`nano ~/.tmux.conf`|конфиг пользователя

**Ввести команду в tmux: **`Ctrl-B `

|Команда в tmux|Описание|
|------------|------------------|
|`w`|Выбрать окно из списка
|`1`(или др. цифра)|Переключение на другое окно
|`c`|Создать новое окно
|`x`|Закрыть текущую часть
|`%`|Разделить окно по вертикали
|`"`|Разделить окно по горизонтали
|`d`|Отсоедениться
|`Up,Down,Right,Left`|Переключение между частями окна
|`Ctrl-стрелка`|Изменить размер окна

#### WIREGUARD
```
sudo apt-get install wireguard
```
закинуть файл конфига в `/etc/wireguard` и переименовать, например в `wg0.conf`
```
sudo wg-quick up wg0                     поднять туннель
sudo wg-quick down wg0                   закрыть туннель
```
>[!tip] В случае возникновения ошибки `/usr/bin/wg-quick: resolvconf: command not found`, вероятно потребуется сделать символическую ссылку `ln -s /usr/bin/resolvectl /usr/local/bin/resolvconf`

###### Свой vpn на vps
1. Сервер с Ubuntu
2. `sudo apt install mc nano wget curl`
3. `wget https://git.io/wireguard -O wireguard-install.sh && bash wireguard-install.sh`  повторяем столько, сколько нужно конфигов
4. `echo 1 | sudo tee /proc/sys/net/ipv4/icmp_echo_ignore_all`  для отключения двустороннего пинга. сбрасывается каждую перезагрузку
5. закидываем получившийся конфиг в `/etc/wireguard/`

|Команда в tmux|Описание|
|------------|------------------|
|`wg`|показать подключения и трафик
|`service wg-quick@wg0 status`|статус службы wireguard
|`cat /etc/wireguard/wg.conf`|конфиг сервера

#### SSH ключи
###### добавить ssh-ключ на сервер
*делаем это на др. машине*

1. `ssh-keygen -t rsa` создаём ключ
2. `cat ~/.ssh/id_rsa.pub` сам ключ
3. `ssh-copy-id root@123.123.123.123` копируем ключ на сервер

>[!info] `/home/username/.ssh/authorized_keys` место хранения авторизированных публичных SSH-ключей

Авторизация по ключу. Чтобы каждый раз не указывать путь, достаточно скопировать закрытый ключ в папку `/home/имя пользователя/.ssh`
```
ssh -i <путь до приватного ключа> username@server IP
```

Файл конфигурации ssh. Для отключения аутентификации по паролю `PasswordAuthentication no` и далее `sudo service ssh restart`
```
sudo nano /etc/ssh/sshd_config
```

Закрытый ключ. Скорее всего, вам никогда не придется просматривать свой закрытый ключ
```
cat ~/.ssh/id_rsa
```

Типичные разрешения для ключей:

|  Item   | Sample    | Numeric | Bitwise |
| --- | --- | --- | --- |
| SSH folder    |  `~/.ssh`   | `700` | `drwx------` |
|Public key|`~/.ssh/id_rsa.pub`|`644`|`-rw-r--r--`|
|Private key|``/.ssh/id_rsa`|`600`|`-rw------`|

#### Передача файлов по SSH
###### Копирование файла с сервера
```
scp root@123.123.123.123:/home/test.txt /directory
```

###### Загрузка файла на сервер
```
scp /home/test.txt root@123.123.123.123:/directory
```

#### FLATPAK
|Команда |Описание|
|------------|------------------|
|`flatpak list`|список установленных пакетов
|`flatpak run org.freedesktop.Piper`|запустить пакет
|`flatpak install flathub org.chocolate_doom.ChocolateDoom`|установить пакет из flathub
|`flatpak uninstall org.chocolate_doom.ChocolateDoom `|удалить пакет
|`flatpak update`|обновить пакеты

#### NMAP
|Команда |Описание|
|------------|------------------|
|`nmap 192.168.0.1`|сканирование портов этого IP
|`nmap 192.168.0.0/24 -sn`|сканировать диапазон, показать все открытые хосты
|`nmap 192.168.31.56 -p 5357 -sV`|сканировать порт 5357 и определить службу его использующую
|`nmap 192.168.31.56 -O`|попытка определения ОС

#### ШРИФТЫ
>[!info] Шрифты хранятся в `/usr/share/fonts`

#### libwrap: /etc/hosts.allow и /etc/hosts.deny
- Все просто, вы вносите в эти файлы имя программы и хосты с которых доступ к программе будет разрешен или запрещен.
- Сначала срабатывают разрешительные правила в /etc/hosts.allow и, если совпадений не было найдено, то система перейдет в /etc/hosts.deny для поиска правил, блокирующих соединение. Если нигде не было найдено совпадений, доступ разрешается.
- Проверить, собрана ли ваша программа с поддержкой libwrap можно командой
```
ldd /usr/sbin/sshd | grep libwrap
```

```
# cat /etc/hosts.allow:  
sshd : 192.168.0.0/24
smtp: 192.168.1.10
http: 192.168.10.                # аналог 192.168.10.0/24
mysqld: LOCAL
```

```
# cat /etc/hosts.deny:  
ALL : ALL
mysqld: ALL
sshd: ALL
```

#### IPTABLES
В Iptables есть четыре основные таблицы:

1. **Filter** - это основная таблица, используемая для фильтрации пакетов.
    
2. **NAT** - эта таблица используется для настройки NAT (Network Address Translation).
    
3. **Mangle** - эта таблица используется для специальной обработки пакетов.
    
4. **Raw** - эта таблица используется для обхода системы отслеживания состояний.
    

Каждая таблица состоит из набора цепочек. Цепочки - это последовательности правил, которые применяются к пакетам. В Iptables есть три встроенные цепочки:

1. **INPUT** - эта цепочка применяется к пакетам, которые предназначены для самой системы.
    
2. **FORWARD** - эта цепочка применяется к пакетам, которые проходят через систему.
    
3. **OUTPUT** - эта цепочка применяется к пакетам, которые исходят из системы.

Примеры действий:
1. ACCEPT – пропустить пакет данных далее по цепочке;
2. DROP – полностью удалить пакет;
3. REJECT – отклонить запрос и направить пользователю ответ с информацией об этом;
4. LOG – инициируется запись в лог-файл об обработанном пакете;
5. QUEUE – отправка данных на компьютер пользователя

Перечень основных действий, для выполнения которых используется Iptables:

1. -A – добавить правило в цепочку;
2. -C – проверить применяемые правила;
3. -D – удалить текущее правило;
4. -I – вставить правило с указанным номером;
5. -L – вывести правила текущей цепочки;
6. -S – вывести все активные правила;
7. -F – очистить все правила;
8. -N – создать цепочку;
9. -X – удалить цепочку;
10. -P – установить действие «по умолчанию».

В качестве дополнительных параметров используются опции:

1. -p – вручную установить протокол (TCP, UDP, UDPLITE, ICMP, ICMPv6, ESP, AH, SCTP, MH);
2. -s – указать статичный IP-адрес оборудования, откуда отправляется пакет данных;
3. -d – установить IP получателя;
4. -i – настроить входной сетевой интерфейс;
5. -o – то же самое в отношении исходящего интерфейса;
6. -j – выбрать действие при подтверждении правила.

Просмотр всех правил
```
iptables -L -n --line-numbers
```

Очистка правил
```
sudo iptables -F
```

Сохранение правила
```
sudo /sbin/iptables-save
```

###### VLC
Проблема заикания звука решается при помощи редактирования  `/etc/pulse/daemon.conf`
```
default-fragments = 5  
default-fragment-size-msec = 2
```
